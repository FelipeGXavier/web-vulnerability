<?php

/*X-Host
X-Forwarded-Server
X-HTTP-Host-Override
Forwarded*/

function checkDnsIntegrity($url) {
    if ((bool) filter_var($url, FILTER_VALIDATE_URL)) {
        $parts = parse_url($url);
        $ipv4 = gethostbyname($parts['host']) ?? '';
        return $ipv4 != '127.0.0.1' && $ipv4 != "localhost";
    }
    return false;
}

$url = filter_var($_GET['url'] ?? '', FILTER_SANITIZE_URL);
$validation = "/^(http|https|ftp):\/\/([A-Z0-9][A-Z0-9_-]*(?:\.[A-Z0-9][A-Z0-9_-]*)+):?(\d+)?\/?/i";
if((bool) preg_match($validation, $url) === false || !checkDnsIntegrity($url)) {
    die("Not Secure URL");
}

$image = fopen($url, 'rb');
header("Content-Type: image/png");

fpassthru($image);

